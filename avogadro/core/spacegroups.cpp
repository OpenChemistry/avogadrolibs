/******************************************************************************

  This source file is part of the Avogadro project.

  Copyright 2014 Albert DeFusco, University of Pittsburgh

  This source code is released under the New BSD License, (the "License").

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.

******************************************************************************/

#include "spacegroups.h"
#include "avospglib.h"
#include <iostream>
#include <string>
#include <vector>


using Avogadro::Core::SpaceGroups;
namespace Avogadro {
namespace Core {

  std::string SpaceGroups::getInternational(int hallNumber)
  {
    std::string Int(spacegroup_types[hallNumber].international);
    return Int;
  }

  std::string SpaceGroups::getInternationalFull(int hallNumber)
  {
    std::string Int(spacegroup_types[hallNumber].international_full);
    return Int;
  }

  std::string SpaceGroups::getInternationalShort(int hallNumber)
  {
    std::string Int(spacegroup_types[hallNumber].international_short);
    return Int;
  }

  std::string SpaceGroups::getBravais(int hallNumber)
  {
    std::string Int(1,spacegroup_types[hallNumber].international[0]);
    return Int;
  }

  std::string SpaceGroups::getSchoenflies(int hallNumber)
  {
    std::string schoenflies(spacegroup_types[hallNumber].schoenflies);
    return schoenflies;
  }

  int SpaceGroups::getNumber(int hallNumber)
  {
    int number(spacegroup_types[hallNumber].number);
    return number;
  }

  std::string SpaceGroups::getHallSymbol(int hallNumber)
  {
    std::string hallSymbol(spacegroup_types[hallNumber].hall_symbol);
    return hallSymbol;
  }

  std::string SpaceGroups::getSetting(int hallNumber)
  {
    std::string setting(spacegroup_types[hallNumber].setting);
    return setting;
  }

  std::string SpaceGroups::getCrystalSystem(int hallNumber)
  {
    crystalSystem sys = spacegroup_types[hallNumber].holohedry;
    std::string sysString;
    switch(sys)
    {
      case NONE:
        sysString = "None";
        break;
      case TRICLI:
        sysString = "Triclinic";
        break;
      case MONOCLI:
        sysString = "Monoclinic";
        break;
      case ORTHO:
        sysString = "Orthorhombic";
        break;
      case TETRA:
        sysString = "Tetragonal";
        break;
      case TRIGO:
        sysString = "Trigonal";
        break;
      case RHOMB:
        sysString = "Rhombohedral";
        break;
      case HEXA:
        sysString = "Hexagonal";
        break;
      case CUBIC:
        sysString = "Cubic";
        break;
    }

    return sysString;
  }

  std::string SpaceGroups::describeSpaceGroup(int hallNumber)
  {
    std::string shortSymbol = getInternationalShort(hallNumber);
    std::string fullSymbol  = getInternationalFull(hallNumber);
    std::string crsytal     = getCrystalSystem(hallNumber);
    int number              = getNumber(hallNumber);
    std::string schoenflies  = getSchoenflies(hallNumber);
    std::string setting     = getSetting(hallNumber);

    std::ostringstream outStream;

    outStream <<
      "<b>Short International Symbol:</b>" << "  " << shortSymbol << "<br>"
      << "<b>Schoenflies symbol:</b>" << "  " << schoenflies << "<br>"
      << "<b>Space group number:</b>" << "  " << number << "<br>"
      << "<b>Full International Symbol:</b>" << "  " << fullSymbol << "<br>";
    if(setting != "     ")
      outStream << "<b>Setting:</b>" << "  " << setting;

    //std::cout << outStream;
    return outStream.str();

  }

  std::vector<SpaceGroups::crystalSystem> SpaceGroups::getCrystalArray()
  {
    std::vector<crystalSystem> crystals;
    crystals.push_back(TRICLI);
    crystals.push_back(MONOCLI);
    crystals.push_back(ORTHO);
    crystals.push_back(TETRA);
    crystals.push_back(TRIGO);
    crystals.push_back(RHOMB);
    crystals.push_back(HEXA);
    crystals.push_back(CUBIC);

    return crystals;

  }
  std::string SpaceGroups::getCrystalString(crystalSystem crystal)
  {
    std::string sysString;
    switch(crystal)
    {
      case NONE:
        sysString = "None";
        break;
      case TRICLI:
        sysString = "Triclinic";
        break;
      case MONOCLI:
        sysString = "Monoclinic";
        break;
      case ORTHO:
        sysString = "Orthorhombic";
        break;
      case TETRA:
        sysString = "Tetragonal";
        break;
      case TRIGO:
        sysString = "Trigonal";
        break;
      case RHOMB:
        sysString = "Rhombohedral";
        break;
      case HEXA:
        sysString = "Hexagonal";
        break;
      case CUBIC:
        sysString = "Cubic";
        break;
    }

    return sysString;
  }

  std::vector<std::string> SpaceGroups::getBravaisArray(crystalSystem crystal)
  {
    std::vector<std::string> bravais;
    for (int hall=0;hall < 530;hall++)
      if (spacegroup_types[hall].holohedry == crystal)
      {
        bravais.push_back(getBravais(hall));
      }
    sort(bravais.begin(), bravais.end());
    bravais.erase(unique(bravais.begin(), bravais.end()), bravais.end());

    return bravais;
  }

  std::vector<std::string> SpaceGroups::getIntSymbolArray(crystalSystem crystal, std::string bravais)
  {
    std::vector<std::string> IntSymbol;
    for(int hall=0;hall<530;hall++)
    {
      if (spacegroup_types[hall].holohedry == crystal)
      {
        if(getBravais(hall) == bravais)
        {
          IntSymbol.push_back(getInternationalShort(hall));
        }
      }
    }
    sort(IntSymbol.begin(), IntSymbol.end());
    IntSymbol.erase(unique(IntSymbol.begin(), IntSymbol.end()), IntSymbol.end());

    return IntSymbol;
  }

  std::vector<std::string> SpaceGroups::getSettingArray(crystalSystem crystal, std::string bravais,std::string intSymbol)
  {
    std::vector<std::string> setting;
    for(int hall=0;hall<530;hall++)
    {
      if (spacegroup_types[hall].holohedry == crystal)
      {
        if(getBravais(hall) == bravais)
        {
          if(getInternationalShort(hall) == intSymbol)
          {
            setting.push_back(getSetting(hall));
          }
        }
      }
    }
    sort(setting.begin(), setting.end());
    setting.erase(unique(setting.begin(), setting.end()), setting.end());

    return setting;
  }

  int SpaceGroups::getHallNumber(crystalSystem crystal, std::string bravais,std::string intSymbol, std::string setting)
  {
    //std::vector<std::string> setting;
    int outputHallNumber;
    for(int hall=0;hall<530;hall++)
    {
      if (spacegroup_types[hall].holohedry == crystal)
      {
        if(getBravais(hall) == bravais)
        {
          if(getInternationalShort(hall) == intSymbol)
          {
            //setting.push_back(getSetting(hall));
            if(getSetting(hall) == setting)
            {
              outputHallNumber=hall;
            }
          }
        }
      }
    }
    //sort(setting.begin(), setting.end());
    //setting.erase(unique(setting.begin(), setting.end()), setting.end());

    return outputHallNumber;
  }





} // namespace Core
} // namespace Avogadro
